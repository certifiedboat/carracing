<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Racing Game</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom CSS for the game canvas and overall layout */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden; /* Prevent scrolling */
        }
        canvas {
            background-color: #333; /* Road background */
            border-radius: 10px; /* Rounded corners for the game area */
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5); /* Subtle shadow */
            display: block; /* Remove extra space below canvas */
            touch-action: none; /* Prevent default touch actions like scrolling/zooming */
        }
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px; /* Space between elements */
            padding: 20px;
        }
        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%; /* Take full width of parent */
            max-width: 400px; /* Match canvas width */
            color: #e2e8f0; /* Light text color */
            font-size: 1.25rem; /* Larger font size */
            font-weight: bold;
        }
        .message-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.7);
            z-index: 100;
            display: none; /* Hidden by default */
            border: 2px solid #4a5568;
        }
        .message-box h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #f6ad55; /* Orange color for heading */
        }
        .message-box p {
            font-size: 1.5rem;
            margin-bottom: 30px;
        }
        .button-primary {
            background-image: linear-gradient(to right, #6366f1, #8b5cf6); /* Gradient background */
            color: white;
            padding: 15px 30px;
            border-radius: 9999px; /* Fully rounded */
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            outline: none; /* Remove outline on focus */
        }
        .button-primary:hover {
            transform: translateY(-3px); /* Lift effect on hover */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        .button-primary:active {
            transform: translateY(1px); /* Press effect on click */
        }

        /* Responsive controls for mobile */
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            width: 100%;
            max-width: 400px;
        }

        .control-button {
            background-color: #4a5568; /* Darker grey */
            color: white;
            padding: 20px;
            border-radius: 50%; /* Circular buttons */
            font-size: 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 80px;
            height: 80px;
            cursor: pointer;
            user-select: none; /* Prevent text selection */
            transition: background-color 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .control-button:active {
            background-color: #2d3748; /* Even darker on press */
            transform: scale(0.95);
        }

        /* Hide controls on larger screens */
        @media (min-width: 768px) {
            .controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-info">
            <div id="scoreDisplay">Score: 0</div>
            <div id="speedDisplay">Speed: 0 km/h</div>
        </div>
        <canvas id="gameCanvas"></canvas>

        <!-- Mobile Controls -->
        <div class="controls">
            <button id="leftButton" class="control-button">◀</button>
            <button id="rightButton" class="control-button">▶</button>
        </div>

        <!-- Message Box (Game Over/Start) -->
        <div id="messageBox" class="message-box">
            <h2 id="messageTitle">Car Racing Game</h2>
            <p id="messageText">Press 'Start Game' to begin!</p>
            <button id="startButton" class="button-primary">Start Game</button>
        </div>
    </div>

    <script>
        // Get canvas and its 2D rendering context
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Get UI elements
        const scoreDisplay = document.getElementById('scoreDisplay');
        const speedDisplay = document.getElementById('speedDisplay');
        const messageBox = document.getElementById('messageBox');
        const messageTitle = document.getElementById('messageTitle');
        const messageText = document.getElementById('messageText');
        const startButton = document.getElementById('startButton');

        // Mobile control buttons
        const leftButton = document.getElementById('leftButton');
        const rightButton = document.getElementById('rightButton');

        // Game settings
        const GAME_WIDTH = 400;
        const GAME_HEIGHT = 600;
        const LANE_WIDTH = GAME_WIDTH / 3; // Three lanes
        const ROAD_COLOR = '#444';
        const LANE_LINE_COLOR = '#eee';
        const LANE_LINE_DASH = [20, 20]; // Dash pattern for lane lines

        // Player car settings
        const PLAYER_CAR_WIDTH = 40;
        const PLAYER_CAR_HEIGHT = 80;
        const PLAYER_CAR_COLOR = '#3b82f6'; // Blue color
        let playerCar = {
            x: GAME_WIDTH / 2 - PLAYER_CAR_WIDTH / 2, // Start in middle lane
            y: GAME_HEIGHT - PLAYER_CAR_HEIGHT - 50, // Near bottom
            width: PLAYER_CAR_WIDTH,
            height: PLAYER_CAR_HEIGHT,
            speedX: 0, // Horizontal speed
            maxSpeedX: 5, // Max horizontal speed
            lane: 1 // 0: left, 1: middle, 2: right
        };

        // Game state variables
        let gameSpeed = 5; // Initial game speed (how fast objects move down)
        let score = 0;
        let gameOver = true;
        let opponentCars = [];
        let lastOpponentTime = 0;
        const OPPONENT_SPAWN_INTERVAL = 1000; // Milliseconds between opponent spawns
        const OPPONENT_CAR_WIDTH = 40;
        const OPPONENT_CAR_HEIGHT = 80;
        const OPPONENT_COLORS = ['#ef4444', '#f97316', '#eab308', '#22c55e', '#ec4899']; // Red, Orange, Yellow, Green, Pink

        // Keyboard input
        let keys = {};

        // Adjust canvas size for responsiveness
        function resizeCanvas() {
            const aspectRatio = GAME_WIDTH / GAME_HEIGHT;
            let newWidth = window.innerWidth * 0.9; // 90% of window width
            let newHeight = newWidth / aspectRatio;

            if (newHeight > window.innerHeight * 0.8) { // If too tall, adjust based on height
                newHeight = window.innerHeight * 0.8;
                newWidth = newHeight * aspectRatio;
            }

            canvas.width = GAME_WIDTH; // Internal drawing resolution
            canvas.height = GAME_HEIGHT;

            // Scale the canvas element itself using CSS for visual display
            canvas.style.width = `${newWidth}px`;
            canvas.style.height = `${newHeight}px`;
        }

        // Initialize canvas size on load and resize
        window.addEventListener('load', resizeCanvas);
        window.addEventListener('resize', resizeCanvas);

        // Event listeners for keyboard input
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
        });

        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // Event listeners for mobile controls
        leftButton.addEventListener('touchstart', () => { keys['ArrowLeft'] = true; });
        leftButton.addEventListener('touchend', () => { keys['ArrowLeft'] = false; });
        rightButton.addEventListener('touchstart', () => { keys['ArrowRight'] = true; });
        rightButton.addEventListener('touchend', () => { keys['ArrowRight'] = false; });

        // Game loop
        function gameLoop(currentTime) {
            if (gameOver) {
                return; // Stop the loop if game is over
            }

            update(currentTime);
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Update game state
        function update(currentTime) {
            // Update player car position based on input
            if (keys['ArrowLeft'] || keys['a']) {
                playerCar.x -= playerCar.maxSpeedX;
            }
            if (keys['ArrowRight'] || keys['d']) {
                playerCar.x += playerCar.maxSpeedX;
            }

            // Keep player car within road boundaries
            playerCar.x = Math.max(0, Math.min(GAME_WIDTH - playerCar.width, playerCar.x));

            // Spawn opponent cars
            if (currentTime - lastOpponentTime > OPPONENT_SPAWN_INTERVAL / (gameSpeed / 5)) { // Faster spawn at higher speeds
                spawnOpponentCar();
                lastOpponentTime = currentTime;
            }

            // Move and update opponent cars
            opponentCars.forEach((car, index) => {
                car.y += gameSpeed; // Move down

                // Remove cars that go off-screen
                if (car.y > GAME_HEIGHT) {
                    opponentCars.splice(index, 1);
                    score++; // Increment score for each car passed
                }

                // Collision detection with player car
                if (checkCollision(playerCar, car)) {
                    endGame();
                }
            });

            // Increase game speed gradually
            gameSpeed += 0.001; // Small increment per frame

            // Update UI
            scoreDisplay.textContent = `Score: ${score}`;
            speedDisplay.textContent = `Speed: ${Math.floor(gameSpeed * 10)} km/h`; // Scale speed for display
        }

        // Draw game elements
        function draw() {
            // Clear canvas
            ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);

            // Draw road
            ctx.fillStyle = ROAD_COLOR;
            ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);

            // Draw lane lines
            ctx.strokeStyle = LANE_LINE_COLOR;
            ctx.lineWidth = 5;
            ctx.setLineDash(LANE_LINE_DASH);

            // Left lane line
            ctx.beginPath();
            ctx.moveTo(LANE_WIDTH, 0);
            ctx.lineTo(LANE_WIDTH, GAME_HEIGHT);
            ctx.stroke();

            // Right lane line
            ctx.beginPath();
            ctx.moveTo(LANE_WIDTH * 2, 0);
            ctx.lineTo(LANE_WIDTH * 2, GAME_HEIGHT);
            ctx.stroke();

            ctx.setLineDash([]); // Reset line dash for other drawings

            // Draw player car
            drawCar(playerCar.x, playerCar.y, playerCar.width, playerCar.height, PLAYER_CAR_COLOR);

            // Draw opponent cars
            opponentCars.forEach(car => {
                drawCar(car.x, car.y, car.width, car.height, car.color);
            });
        }

        // Helper function to draw a car (simple rectangle for now)
        function drawCar(x, y, width, height, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x, y, width, height);

            // Add a simple window/windshield
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)'; // Lighter color for window
            ctx.fillRect(x + width * 0.1, y + height * 0.1, width * 0.8, height * 0.2);

            // Add wheels (simple circles/rectangles)
            ctx.fillStyle = '#333'; // Dark grey for wheels
            ctx.fillRect(x - 5, y + height * 0.2, 10, height * 0.2); // Left front
            ctx.fillRect(x + width - 5, y + height * 0.2, 10, height * 0.2); // Right front
            ctx.fillRect(x - 5, y + height * 0.6, 10, height * 0.2); // Left rear
            ctx.fillRect(x + width - 5, y + height * 0.6, 10, height * 0.2); // Right rear
        }


        // Spawn a new opponent car
        function spawnOpponentCar() {
            const lane = Math.floor(Math.random() * 3); // Random lane (0, 1, or 2)
            const x = lane * LANE_WIDTH + (LANE_WIDTH - OPPONENT_CAR_WIDTH) / 2;
            const color = OPPONENT_COLORS[Math.floor(Math.random() * OPPONENT_COLORS.length)];
            opponentCars.push({
                x: x,
                y: -OPPONENT_CAR_HEIGHT, // Start above the screen
                width: OPPONENT_CAR_WIDTH,
                height: OPPONENT_CAR_HEIGHT,
                color: color
            });
        }

        // Check for collision between two rectangles
        function checkCollision(obj1, obj2) {
            return obj1.x < obj2.x + obj2.width &&
                   obj1.x + obj1.width > obj2.x &&
                   obj1.y < obj2.y + obj2.height &&
                   obj1.y + obj1.height > obj2.y;
        }

        // End the game
        function endGame() {
            gameOver = true;
            messageTitle.textContent = 'Game Over!';
            messageText.textContent = `You scored: ${score} points.`;
            startButton.textContent = 'Restart Game';
            messageBox.style.display = 'block'; // Show game over message
        }

        // Start/Restart game
        function startGame() {
            gameOver = false;
            score = 0;
            gameSpeed = 5;
            playerCar.x = GAME_WIDTH / 2 - PLAYER_CAR_WIDTH / 2; // Reset player position
            opponentCars = []; // Clear opponent cars
            lastOpponentTime = performance.now(); // Reset timer for opponent spawning
            messageBox.style.display = 'none'; // Hide message box
            requestAnimationFrame(gameLoop); // Start the game loop
        }

        // Event listener for the start/restart button
        startButton.addEventListener('click', startGame);

        // Show initial message box when the page loads
        window.onload = function() {
            resizeCanvas(); // Ensure canvas is sized correctly on load
            messageBox.style.display = 'block';
        };
    </script>
</body>
</html>
